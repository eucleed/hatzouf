{"name":"Hatzouf","tagline":"IOT Framework","body":"### Welcome to hatzouf IOT framework\r\nThe hatzouf iot framework is the easiest way to provide interconnection with electronic devices.\r\n\r\n### Get started\r\n\r\n#### Install the server\r\n\r\nAt least JDK 1.7 is required.\r\n\r\nDownload hatzouf server [Hatzouf](http://72.13.93.222/hatzouf-0.0.1.zip)\r\n\r\nrun \r\n\r\nbin/startup.sh on linux \r\n\r\nor\r\n\r\nbin/startup.bat on windows\r\n\r\n\r\nCheck if server is running http://localhost:8080/hatzouf\r\n\r\n#### Create a driver\r\n```\r\n<dependency>\r\n  <groupId>org.castafiore</groupId>\r\n  <artifactId>iot.driver.java</artifactId>\r\n  <version>0.0.1-SNAPSHOT</version>\r\n</dependency>\r\n\r\n```\r\n\r\n###Example \r\nIn this example we will create a simple remote controlled Lamp.\r\n\r\nWe need 2 devices: A lamp and a remote control with 2 buttons. On and Off\r\n\r\nThe remote control publishes 2 types of event : OnSwitchOn and OnSwitchOff\r\n\r\nThe lamp captures 2 events : SwitchOn and SwitchOff\r\n\r\nNow that we have made the design, let us build the system.\r\n\r\n####1.   The Lamp\r\nSince we do not have a device embedded with linux yet, we will create a simple java swing interface to emulate the lamp.\r\n\r\nThe lamp need to be able to receive 2 events. i.e. SwitchOn and SwitchOff\r\n\r\n```\r\npublic static void main(String[] args) {\r\n\t\t//1. Create an instance of device\r\n\t\tfinal Device lamp = new Device(\"Lamp\", \"Lamp\",\"Lamp\" ,\"img/lamp.png\");\r\n\t\t\r\n\t\t//2. Register the 2 functions\r\n\t\tlamp.registerFunction(\"SwitchOn\", \"Function exposed to server\");\r\n\t\tlamp.registerFunction(\"SwitchOff\", \"Function exposed to server for switching off the device\");\r\n\t\t\r\n\t\t//3. Set the type of communication layer. In this case it is a java implementation of websocket.\r\n\t\t//Depending the environment the driver is running, other implementation of the websocket layer can be injected\r\n\t\tlamp.setWebsocketLayer(new JavaWebsocketLayer(lamp));\r\n\t\t\r\n\t\t//a simple text label to display if lamp is on or off.\r\n\t\t//in a real lamp, instead displaying a label, the microcontroller will send an electric signal to a switch\r\n\t\tfinal JLabel state = new JLabel();\r\n\t\t\r\n\t\t//4. Add function handlers to execute the captured events\r\n\t\t//this implementation of the handler simply diplays Switched on or Switched off\r\n\t\tlamp.addFunctionHandler(new FunctionHandler() {\r\n\t\t\t\r\n\t\t\t@Override\r\n\t\t\tpublic void execute(String name, Map<String, String> input) {\r\n\t\t\t\ttry{\r\n\t\t\t\t\r\n\t\t\t\t\tif(name.equals(\"SwitchOn\")){\r\n\t\t\t\t\t\tstate.setIcon(new ImageIcon(new URL(\"http://localhost:8080/hatzouf/img/light-on.png\")));\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tstate.setIcon(new ImageIcon(new URL(\"http://localhost:8080/hatzouf/img/light-off.png\")));\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(Exception e){\r\n\t\t\t\t\te.printStackTrace();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//5. This handler is executed when the device is connected and ready for use.\r\n\t\tlamp.onReady(new OnReady() {\r\n\t\t\t\r\n\t\t\t@Override\r\n\t\t\tpublic void ready() {\r\n\t\t\t\tJFrame frame = new JFrame(\"Lamp\");\r\n\t\t\t\tframe.getContentPane().add(state, BorderLayout.NORTH);\r\n\t\t\t\tframe.setSize(300, 275);\r\n\t\t\t\tframe.setVisible(true);\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//6. connect the device to the hatzouf server\r\n\t\tlamp.connect(\"ws://localhost:8080/hatzouf/websockets/iot\");\r\n\t\t\r\n\t}\r\n```\r\n\r\n####2.  The remote control.\r\nThe remote control need to publish 2 events i.e OnSwitchOn and OnSwitchOff\r\n\r\nHere is the code for creating the remote control.\r\n```\r\npublic static void main(String[] args) {\r\n\r\n\t\t//create an instance of the device\r\n\t\tfinal Device remotecontrol = new Device(\"Remote\", \"Remote\", \"Remote control\", \"img/remote.png\");\r\n\t\t//register the 2 events\r\n\t\tremotecontrol.registerEvent(\"OnSwitchOn\", \"Switch on\");\r\n\t\tremotecontrol.registerEvent(\"OnSwitchOff\", \"Switch off\");\r\n\t\t\r\n\t\t\r\n\t\tremotecontrol.onReady(new OnReady() {\r\n\r\n\t\t\t@Override\r\n\t\t\tpublic void ready() {\r\n\r\n\t\t\t\tString title = \"Remote control\";\r\n\t\t\t\tJFrame frame = new JFrame(title);\r\n\t\t\t\tframe.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\r\n\t\t\t\tJButton switchon = new JButton(\"Switch on\");\r\n\t\t\t\tswitchon.addActionListener(new ActionListener() {\r\n\t\t\t\t\t\r\n\t\t\t\t\t@Override\r\n\t\t\t\t\tpublic void actionPerformed(ActionEvent e) {\r\n\t\t\t\t\t\tremotecontrol.propagateEvent(\"OnSwitchOn\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tJButton switchoff = new JButton(\"Switch off\");\r\n\t\t\t\tswitchoff.addActionListener(new ActionListener() {\r\n\t\t\t\t\t\r\n\t\t\t\t\t@Override\r\n\t\t\t\t\tpublic void actionPerformed(ActionEvent e) {\r\n\t\t\t\t\t\tremotecontrol.propagateEvent(\"OnSwitchOff\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tContainer contentPane = frame.getContentPane();\r\n\t\t\t\tcontentPane.add(switchon, BorderLayout.NORTH);\r\n\t\t\t\tcontentPane.add(switchoff, BorderLayout.SOUTH);\r\n\r\n\t\t\t\tframe.setSize(150, 100);\r\n\t\t\t\tframe.setVisible(true);\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t\t//set WebsocketLayer implementation\r\n\t\tremotecontrol.setWebsocketLayer(new JavaWebsocketLayer(remotecontrol));\r\n\t\t//connect to server\r\n\t\tremotecontrol.connect(\"ws://localhost:8080/hatzouf/websockets/iot\");\r\n\t\t\r\n\r\n\t}\r\n```\r\n\r\n\r\n#### 3. The server\r\nUp to now, we have created our devices and connected them to the server.\r\n\r\nTo check if the devices are working properly:\r\n\r\ngo to [http://localhost:8080/hatzouf](http://localhost:8080/hatzouf)\r\n\r\nClick refresh.\r\n\r\nYou should see the devices and their status.\r\n\r\nWe need to create an iot application which will do the following\r\n\r\n1. Capture the OnSwitchOn event from the remote control and execute the SwichOn function in the lamp.\r\n\r\n2. Capture the OnSwitchOff event.....\r\n\r\nGood news an IOTApplet is in fact a spring managed bean.\r\n\r\nThe code below is the implementation of the IOTApplet\r\n\r\n```\r\npublic class RemoteControlApplet extends GenericIOTApplet {\r\n\r\n\tpublic RemoteControlApplet(){\r\n\t\t//add the required devices to be used\r\n\t\taddRequiredDeviceName(\"Lamp\");\r\n\t\taddRequiredDeviceName(\"Remote\");\r\n\t\t\r\n\t}\r\n\r\n\t@Override\r\n\tpublic void initDevice(Device device) {\r\n\t\t//when device is first initialised, we add the listener for the 2 events on the remote control\r\n\t\tif(device.getName().equals(\"Remote\")){\r\n\t\t\tdevice.addEvent(new OnSwitchOn(), \"OnSwitchOn\");\r\n\t\t\tdevice.addEvent(new OnSwitchOff(), \"OnSwitchOff\");\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * Implementation of the OnSwitchOn listener\r\n\t *\r\n\t */\r\n\tclass OnSwitchOn implements EventListener{\r\n\r\n\t\t@Override\r\n\t\tpublic void execute(Device source, String type,\r\n\t\t\t\tMap<String, String> parameters) {\r\n\t\t\t//finds the device and invoke the SwitchOn function\r\n\t\t\tfindDeviceByName(\"Lamp\").invoke(\"SwitchOn\");\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tclass OnSwitchOff implements EventListener{\r\n\r\n\t\t@Override\r\n\t\tpublic void execute(Device source, String type,\tMap<String, String> parameters) {\r\n\t\t\t\r\n\t\t\t//finds the Lamp device and invokes the SwitchOff event\r\n\t\t\tfindDeviceByName(\"Lamp\").invoke(\"SwitchOff\");\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n}\r\n```\r\n\r\n#### Configure the server to run the IOTApplet\r\n\r\nSimply create a spring application context file with the following convention\r\n\r\n1.  The file name should be xxx-config.xml, where xxx could by anything\r\n\r\n2.  The file should be in folder WEB-INF/configs in the iot directory.\r\n\r\n```\r\n<bean class=\"org.castafiore.iot.RemoteControlApplet\">\r\n   <property name=\"registry\" ref=\"deviceRegistry\"></property>\r\n</bean>\r\n```\r\n\r\n3. Restart the server.\r\n\r\n\r\nThe remote controlled switch is ready for use.\r\n\r\nstart the 2 devices.\r\n\r\nclick on the switch on and switch off button and see if it reacts on the lamp device.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}