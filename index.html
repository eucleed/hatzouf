<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Hatzouf : IOT Framework">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Hatzouf</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/eucleed/hatzouf">View on GitHub</a>

          <h1 id="project_title">Hatzouf</h1>
          <h2 id="project_tagline">IOT Framework</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/eucleed/hatzouf/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/eucleed/hatzouf/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a id="welcome-to-hatzouf-iot-framework" class="anchor" href="#welcome-to-hatzouf-iot-framework" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to hatzouf IOT framework</h3>

<p>The hatzouf iot framework is the easiest way to provide interconnection with electronic devices.</p>

<h3>
<a id="get-started" class="anchor" href="#get-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get started</h3>

<h4>
<a id="install-the-server" class="anchor" href="#install-the-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install the server</h4>

<p>At least JDK 1.7 is required.</p>

<p>Download hatzouf server <a href="http://72.13.93.222/hatzouf-0.0.1.zip">Hatzouf</a></p>

<p>run </p>

<pre><code>bin/startup.sh on linux 
</code></pre>

<p>or</p>

<pre><code>bin/startup.bat on windows
</code></pre>

<p>Check if server is running http://localhost:8080/hatzouf</p>

<h4>
<a id="create-a-driver" class="anchor" href="#create-a-driver" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a driver</h4>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;org.castafiore&lt;/groupId&gt;
  &lt;artifactId&gt;iot.driver.java&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;

</code></pre>

<h3>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h3>

<p>In this example we will create a simple remote controlled Lamp.</p>

<p>We need 2 devices: A lamp and a remote control with 2 buttons. On and Off</p>

<p>The remote control publishes 2 types of event : OnSwitchOn and OnSwitchOff</p>

<p>The lamp captures 2 events : SwitchOn and SwitchOff</p>

<p>Now that we have made the design, let us build the system.</p>

<h4>
<a id="1---the-lamp" class="anchor" href="#1---the-lamp" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.   The Lamp</h4>

<p>Since we do not have a device embedded with linux yet, we will create a simple java swing interface to emulate the lamp.</p>

<p>The lamp need to be able to receive 2 events. i.e. SwitchOn and SwitchOff</p>

<h5>
<a id="create-an-instance-of-device" class="anchor" href="#create-an-instance-of-device" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create an instance of device</h5>

<pre><code>final Device lamp = new Device("Lamp", "Lamp","Lamp" ,"img/lamp.png");
</code></pre>

<h5>
<a id="register-the-2-functions" class="anchor" href="#register-the-2-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Register the 2 functions</h5>

<pre><code> lamp.registerFunction("SwitchOn", "Function exposed to server");
 lamp.registerFunction("SwitchOff", "Function exposed to server");
</code></pre>

<h5>
<a id="set-the-type-of-communication-layer" class="anchor" href="#set-the-type-of-communication-layer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Set the type of communication layer.</h5>

<p>In this case it is a java implementation of websocket.</p>

<p>Depending the environment the driver is running, other implementation of the websocket layer can be injected</p>

<pre><code> lamp.setWebsocketLayer(new JavaWebsocketLayer(lamp));
</code></pre>

<h5>
<a id="add-function-handlers-to-execute-the-captured-events" class="anchor" href="#add-function-handlers-to-execute-the-captured-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add function handlers to execute the captured events</h5>

<pre><code>        lamp.addFunctionHandler(new FunctionHandler() {

            @Override
            public void execute(String name, Map&lt;String, String&gt; input) {
                ...
            }
        });
</code></pre>

<h5>
<a id="add-on-ready-event-to-continue" class="anchor" href="#add-on-ready-event-to-continue" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add on ready event to continue.</h5>

<pre><code>lamp.onReady(new OnReady() {            
    public void ready() {
        ...
    }
});
</code></pre>

<h5>
<a id="connect-the-device-to-the-hatzouf-server" class="anchor" href="#connect-the-device-to-the-hatzouf-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connect the device to the hatzouf server</h5>

<pre><code>  lamp.connect("ws://localhost:8080/hatzouf/websockets/iot");
</code></pre>

<h4>
<a id="the-remote-control" class="anchor" href="#the-remote-control" aria-hidden="true"><span class="octicon octicon-link"></span></a>The remote control.</h4>

<p>The remote control need to publish 2 events i.e OnSwitchOn and OnSwitchOff</p>

<h5>
<a id="register-events-for-a-device" class="anchor" href="#register-events-for-a-device" aria-hidden="true"><span class="octicon octicon-link"></span></a>Register events for a device</h5>

<pre><code>  remotecontrol.registerEvent("OnSwitchOn", "Switch on");
  remotecontrol.registerEvent("OnSwitchOff", "Switch off");
</code></pre>

<h5>
<a id="propagate-an-event-to-hatzouf-server" class="anchor" href="#propagate-an-event-to-hatzouf-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Propagate an event to hatzouf server</h5>

<pre><code>remotecontrol.propagateEvent("OnSwitchOn");

</code></pre>

<h4>
<a id="3-the-server" class="anchor" href="#3-the-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. The server</h4>

<p>Up to now, we have created our devices and connected them to the server.</p>

<p>To check if the devices are working properly:</p>

<p>go to <a href="http://localhost:8080/hatzouf">http://localhost:8080/hatzouf</a></p>

<p>Click refresh.</p>

<p>You should see the devices and their status.</p>

<p>We need to create an iot application which will do the following</p>

<p>Capture the OnSwitchOn event from the remote control and execute the SwitchOn function in the lamp.</p>

<p>Capture the OnSwitchOff event.....</p>

<p>Good news an IOTApplet is in fact a spring managed bean.</p>

<h5>
<a id="create-a-new-iotapplet" class="anchor" href="#create-a-new-iotapplet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a new IOTApplet</h5>

<pre><code>public class RemoteControlApplet extends GenericIOTApplet {
....
}
</code></pre>

<h5>
<a id="add-devices-to-be-managed" class="anchor" href="#add-devices-to-be-managed" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add devices to be managed</h5>

<pre><code>addRequiredDeviceName("Lamp");
addRequiredDeviceName("Remote");

</code></pre>

<h5>
<a id="add-listeners-to-remote-device-events" class="anchor" href="#add-listeners-to-remote-device-events" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add listeners to remote device events</h5>

<pre><code>device.addEvent(new OnSwitchOn(), "OnSwitchOn");
device.addEvent(new OnSwitchOff(), "OnSwitchOff");

</code></pre>

<h5>
<a id="create-an-event-listener" class="anchor" href="#create-an-event-listener" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create an event listener</h5>

<pre><code>class OnSwitchOn implements EventListener{

        @Override
        public void execute(Device source, String type, Map&lt;String, String&gt; parameters) {
            ....
        }

    }
</code></pre>

<h4>
<a id="configure-the-server-to-run-the-iotapplet" class="anchor" href="#configure-the-server-to-run-the-iotapplet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure the server to run the IOTApplet</h4>

<p>Simply create a spring application context file with the following convention</p>

<p>The file name should be xxx-config.xml, where xxx could by anything</p>

<p>The file should be in folder WEB-INF/configs in the iot directory.</p>

<pre><code>&lt;bean class="org.castafiore.iot.RemoteControlApplet"&gt;
   &lt;property name="registry" ref="deviceRegistry"&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre>

<ol>
<li>Restart the server.</li>
</ol>

<p>The remote controlled switch is ready for use.</p>

<p>Start the 2 devices.</p>

<p>click on the switch on and switch off button and see if it reacts on the lamp device.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Hatzouf maintained by <a href="https://github.com/eucleed">eucleed</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
